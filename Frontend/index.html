<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ú–µ—Ç–µ–æ—Å–∏—Å—Ç–µ–º–∞</title>
  <link rel="stylesheet" href="./main.css" />

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ (–ú–ï–¢–ï–û–ë–Æ–õ–õ–ï–¢–ï–ù–¨ / –ñ–£–†–ù–ê–õ –ò–ó–ú–ï–†–ï–ù–ò–ô)
      const tabButtons = document.querySelectorAll('.meteo__nav-btn');
      const tabContents = document.querySelectorAll('.meteo__tab');

      tabButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å active –Ω–∞ –≤—Å–µ—Ö –∫–Ω–æ–ø–∫–∞—Ö
          tabButtons.forEach(b => b.classList.remove('meteo__nav-btn--active'));
          // –ù–∞–∑–Ω–∞—á–∞–µ–º active –Ω–∞ —Ç–µ–∫—É—â—É—é
          btn.classList.add('meteo__nav-btn--active');

          const targetTab = btn.getAttribute('data-tab');

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, —Å–∫—Ä—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ
          tabContents.forEach(tc => {
            if (tc.id === targetTab) {
              tc.classList.remove('meteo__tab--hidden');
            } else {
              tc.classList.add('meteo__tab--hidden');
            }
          });
        });
      });

      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ (–î–ú–ö / –í–†)
      const modeButtons = document.querySelectorAll('.mode-selector__btn');
      const windSpeedGroup = document.getElementById('windSpeedGroup');
      const bulletDriftGroup = document.getElementById('bulletDriftGroup');
      let currentMode = 'dmk'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –î–ú–ö

      modeButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          modeButtons.forEach(b => b.classList.remove('mode-selector__btn--active'));
          btn.classList.add('mode-selector__btn--active');
          currentMode = btn.getAttribute('data-mode');

          if (currentMode === 'dmk') {
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º "–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞"
            windSpeedGroup.style.display = 'flex';
            // –°–∫—Ä—ã–≤–∞–µ–º "–î–∞–ª—å–Ω–æ—Å—Ç—å —Å–Ω–æ—Å–∞ –ø—É–ª—å"
            bulletDriftGroup.style.display = 'none';
          } else {
            // –°–∫—Ä—ã–≤–∞–µ–º "–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞"
            windSpeedGroup.style.display = 'none';
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º "–î–∞–ª—å–Ω–æ—Å—Ç—å —Å–Ω–æ—Å–∞ –ø—É–ª—å"
            bulletDriftGroup.style.display = 'flex';
          }

          checkFormValidity();
        });
      });

      // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
      const inputs = document.querySelectorAll('.input-form__field');
      const createBtn = document.getElementById('createMeteo11');

      inputs.forEach(input => {
        input.addEventListener('input', checkFormValidity);
      });

      function checkFormValidity() {
        let allValid = true;

        inputs.forEach(input => {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ –∏–Ω–ø—É—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–∏–º—ã (–Ω–µ —Å–∫—Ä—ã—Ç—ã —á–µ—Ä–µ–∑ display: none)
          if (input.parentElement.style.display !== 'none') {
            if (input.value.trim() === '') {
              allValid = false;
            }
            
            const value = parseFloat(input.value);
            /*const min = parseFloat(input.min);
            const max = parseFloat(input.max);
            
            if (input.hasAttribute('min') && value < min) {
              allValid = false;
            }
            if (input.hasAttribute('max') && value > max) {
              allValid = false;
            }*/
          }
        });

        createBtn.disabled = !allValid;
      }

      // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã "–ú–ï–¢–ï–û-11 –ü–†–ò–ë–õ–ò–ñ–ï–ù–ù–´–ô" –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏–Ω—è—Ç—å –∫–∞–∫ –î–µ–π—Å—Ç–≤."
      const meteoTableBodies = document.querySelectorAll('.meteo-table__body');
      const acceptBtn = document.getElementById('acceptBtn');

      createBtn.addEventListener('click', () => {


        fetch('http://localhost:3000/rpc/fnHeaderCreate?height_=200&temperature=28&pressure=726&wind_speed=20&wind_direction=0.2')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          document.getElementById("header-data-1").innerHTML = data[0]["datetime"];
          document.getElementById("header-pressure-1").innerHTML = data[0]["height"];
          document.getElementById("header-params-1").innerHTML = data[0]["pressure_temperature"];
        })
        .catch(error => {
          console.error('Error:', error);
        });


        




        // –û—á–∏—â–∞–µ–º –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –æ–±–µ —Ç–∞–±–ª–∏—Ü—ã
        meteoTableBodies.forEach(tableBody => {
          tableBody.innerHTML = ''; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      
          for (let i = 0; i < 8; i++) {
            const row = document.createElement('tr');
            row.className = 'meteo-table__row';
            
            const cells = ['diCell', 'dtCell', 'dWCell', 'wCell'].map(() => {
              const cell = document.createElement('td');
              cell.className = 'meteo-table__cell';
              return cell;
            });
      
            cells[0].textContent = i * 2;
            cells[1].textContent = `0${i} —á`;
            cells[2].textContent = (Math.random() * 10).toFixed(2);
            cells[3].textContent = (Math.random() * 5).toFixed(2);
            
            cells.forEach(cell => row.appendChild(cell));
            tableBody.appendChild(row);
          }
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å –∫–∞–∫ –î–µ–π—Å—Ç–≤."
        acceptBtn.classList.remove('meteo-btn--hidden');
      });

      acceptBtn.addEventListener('click', () => {
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª –∏–∑–º–µ—Ä–µ–Ω–∏–π
        const logBody = document.querySelector('.log__body');
        const now = new Date();
        const dateStr = `${now.getDate().toString().padStart(2, '0')}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getFullYear()} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        
        const row = document.createElement('tr');
        row.className = 'log__row';
        
        const data = [
          dateStr,
          document.getElementById('height').value,
          document.getElementById('temperature').value,
          document.getElementById('pressure').value,
          document.getElementById('windDirection').value,
          currentMode === 'dmk' ? 
            document.getElementById('windSpeed').value : 
            document.getElementById('bulletDrift').value
        ];
        
        data.forEach(text => {
          const cell = document.createElement('td');
          cell.className = 'log__cell';
          cell.textContent = text;
          row.appendChild(cell);
        });
        
        logBody.appendChild(row);
        
        alert('–ü—Ä–∏–Ω—è—Ç –∫–∞–∫ –¥–µ–π—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–µ–æ–±—é–ª–ª–µ—Ç–µ–Ω—å!');
      });
    });


  </script>
</head>
<body>
  <div class="meteo">
    <nav class="meteo__nav">
      <button class="meteo__nav-btn meteo__nav-btn--active" data-tab="meteo-bulletin">–ú–ï–¢–ï–û–ë–Æ–õ–õ–ï–¢–ï–ù–¨</button>
      <button class="meteo__nav-btn" data-tab="measurement-log">–ñ–£–†–ù–ê–õ –ò–ó–ú–ï–†–ï–ù–ò–ô</button>
    </nav>

    <div class="meteo__tab" id="meteo-bulletin">
      <div class="meteo__content">
        <!-- Left Panel -->
        <div class="input-panel">
          <div class="input-panel__header">
            <div class="mode-selector">
              <button class="mode-selector__btn mode-selector__btn--active" data-mode="dmk">–î–ú–ö</button>
              <button class="mode-selector__btn" data-mode="vr">–í–†</button>
            </div>
          </div>

          <div class="input-form">
            <div class="input-form__group">
              <label class="input-form__label" for="height">–í—ã—Å–æ—Ç–∞ –º–µ—Ç–µ–æ–ø–æ—Å—Ç–∞</label>
              <input class="input-form__field" type="number" id="height" name="height" step="1" value="100">
            </div>
            <div class="input-form__group">
              <label class="input-form__label" for="temperature">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</label>
              <input class="input-form__field" type="number" id="temperature" name="temperature" step="0.1" value="15">
            </div>
            <div class="input-form__group">
              <label class="input-form__label" for="pressure">–î–∞–≤–ª–µ–Ω–∏–µ</label>
              <input class="input-form__field" type="number" id="pressure" name="pressure" step="1" value="750">
            </div>
            <div class="input-form__group">
              <label class="input-form__label" for="windDirection">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞</label>
              <input class="input-form__field" type="number" id="windDirection" name="windDirection" step="1" value="0">
            </div>
            <div class="input-form__group" id="windSpeedGroup">
              <label class="input-form__label" for="windSpeed">–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞</label>
              <input class="input-form__field" type="number" id="windSpeed" name="windSpeed" step="1" value="0">
            </div>
            <div class="input-form__group" id="bulletDriftGroup" style="display: none;">
              <label class="input-form__label" for="bulletDrift">–î–∞–ª—å–Ω–æ—Å—Ç—å —Å–Ω–æ—Å–∞ –ø—É–ª—å</label>
              <input class="input-form__field" type="number" id="bulletDrift" name="bulletDrift" step="1" value="0">
            </div>
          </div>

          <button class="meteo-btn meteo-btn--primary" id="createMeteo11">–°–û–°–¢–ê–í–ò–¢–¨ –ú–ï–¢–ï–û-11</button>
          <button class="meteo-btn meteo-btn--red" id="acceptBtn">–ü–†–ò–ù–Ø–¢–¨ –ö–ê–ö –î–ï–ô–°–¢–í.</button>
        </div>

        <!-- Right Panel - –ú–ï–¢–ï–û-11 –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω—ã–π -->
        <div class="result-panel">
          <div class="result-panel__header">
            <div class="result-panel__title">
              –ú–ï–¢–ï–û-11 <span class="result-panel__subtitle">–ø—Ä–∏–±–ª–∏–∂—ë–Ω–Ω—ã–π</span>
            </div>
          </div>

          <div class="result-panel__dates">
            <div class="result-panel__date" id="header-data-1">–î–î–ß–ß–ú</div>
            <div class="result-panel__date" id="header-pressure-1">–í–í–í–í</div>
            <div class="result-panel__date" id="header-params-1">–ë–ë–ë–¢–¢</div>
          </div>

          <div class="result-panel__header">
            <div class="result-panel__dt-list">
              <div class="result-panel__dt">ŒîT</div>
              <div class="result-panel__dt">ùõÇW</div>
              <div class="result-panel__dt">W</div>
            </div>
          </div>

          <div class="meteo-table">
            <table class="meteo-table__content">
              <tbody class="meteo-table__body">
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell">02</td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell">04</td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell">08</td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell">12</td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell">16</td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell">20</td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell">24</td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell">30</td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                    <td class="meteo-table__cell">40</td>
                    <td class="meteo-table__cell"></td>
                    <td class="meteo-table__cell"></td>
                    <td class="meteo-table__cell"></td>
                  </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Right Panel - –ú–ï–¢–ï–û-11 -->
        <div class="result-panel">
          <div class="result-panel__header">
            <div class="result-panel__title">–ú–ï–¢–ï–û-11</div>
          </div>

          <div class="result-panel__dates">
            <div class="result-panel__date">–î–î–ß–ß–ú</div>
            <div class="result-panel__date">–î–î–ß–ß–ú</div>
            <div class="result-panel__date">–î–î–ß–ß–ú</div>
          </div>

          <div class="result-panel__header">
            <div class="result-panel__dt-list">
              <div class="result-panel__dt">dt</div>
              <div class="result-panel__dt">dt</div>
              <div class="result-panel__dt">dt</div>
            </div>
          </div>

          <div class="meteo-table">
            <table class="meteo-table__content">
              <tbody class="meteo-table__body">
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
                <tr class="meteo-table__row">
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                  <td class="meteo-table__cell"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- –ñ—É—Ä–Ω–∞–ª –∏–∑–º–µ—Ä–µ–Ω–∏–π tab -->
    <div class="meteo__tab meteo__tab--hidden" id="measurement-log">
      <h2 class="meteo__heading">–ñ—É—Ä–Ω–∞–ª –∏–∑–º–µ—Ä–µ–Ω–∏–π</h2>
      <div class="log">
        <table class="log__table">
          <thead class="log__header">
            <tr class="log__row">
              <th class="log__cell log__cell--header">–î–∞—Ç–∞</th>
              <th class="log__cell log__cell--header">–í—ã—Å–æ—Ç–∞</th>
              <th class="log__cell log__cell--header">–¢–µ–º–ø.</th>
              <th class="log__cell log__cell--header">–î–∞–≤–ª.</th>
              <th class="log__cell log__cell--header">–ù–∞–ø—Ä. –≤–µ—Ç—Ä–∞</th>
              <th class="log__cell log__cell--header">–°–∫–æ—Ä–æ—Å—Ç—å/–î–∞–ª—å–Ω–æ—Å—Ç—å</th>
            </tr>
          </thead>
          <tbody class="log__body">
            <!-- Dynamic content -->
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
            <tr class="log__row">
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
              <td class="log__cell"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</body>
</html>
